version: '3.7'
services:
  nevatrip:
    build:
      context: .
      args:
        PROJECT_NAME: ${PROJECT_NAME}
        PROJECT_ID: ${PROJECT_ID}
        PROJECT_DATASET: ${PROJECT_DATASET}
    env_file:
      - nevatrip.env
    tty: true
    restart: unless-stopped
    networks:
      - app-network

  moskvatrip:
    build:
      context: .
      args:
        PROJECT_NAME: ${PROJECT_NAME}
        PROJECT_ID: ${PROJECT_ID}
        PROJECT_DATASET: ${PROJECT_DATASET}
    env_file:
      - moskvatrip.env
    tty: true
    restart: unless-stopped
    networks:
      - app-network

  nginx:
    build: ./.config
    image: umputun/nginx-le:latest
    hostname: nginx
    restart: unless-stopped
    container_name: nginx
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"
    volumes:
      - ./.config/etc/ssl:/etc/nginx/ssl
      - ./.config/etc/admin-moskvatrip-ru.conf:/etc/nginx/service-admin-moskvatrip-ru.conf
      - ./.config/etc/admin-nevatrip-ru.conf:/etc/nginx/service-admin-nevatrip-ru.conf
      - ./static:/srv/docroot
    ports:
      - 80:80
      - 443:443
    environment:
      - TZ=Europe/Moscow
      - LETSENCRYPT=true
      - LE_EMAIL=tech-support@nevatrip.ru
      - LE_FQDN=admin.moskvatrip.ru,admin.nevatrip.ru
    depends_on:
      - nevatrip
      - moskvatrip
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
