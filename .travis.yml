sudo: true
language: node_js
node_js:
- stable
os:
- linux
addons:
  ssh_known_hosts: 130.193.54.238
before_install:
- openssl aes-256-cbc -K $encrypted_504078b5b0bc_key -iv $encrypted_504078b5b0bc_iv
  -in deploy.gpg.enc -out deploy.gpg -d
- gpg --import deploy.gpg
- export TZ=Europe/Moscow
- date
- curl -L https://github.com/minrk/git-crypt-bin/releases/download/0.6.0/git-crypt
  > git-crypt
- echo "128817a63de17a5af03fe69241e453436c6c286c86dd37fb70ed9b3bf7171d7d  git-crypt"
  | shasum -a 256 -c -
- chmod +x git-crypt
- sudo cp git-crypt /usr/local/bin/
- git-crypt unlock
install:
- yarn global add @sanity/cli
script:
- sanity install
- sanity build --no-minify
- ls -la ./dist
before_deploy:
- openssl aes-256-cbc -K $encrypted_504078b5b0bc_key -iv $encrypted_504078b5b0bc_iv
  -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
deploy:
  provider: script
  skip_cleanup: true
  script: rsync -r --delete-after --quiet $TRAVIS_BUILD_DIR/dist deploy@130.193.54.238:admin
branches:
  only:
  - master
  - develop
env:
  global:
    secure: c8XFAc6KMvUF6Bo+a6nrM8z4/Cfa4AG02datXEzyxz0ekIyeIHU37xROkZrTvbeQdk5f4aCaTeGOhIG8QyKA07EvmsJ24mUn/lKgZyq6+XH/u5e2xhK/VblXTL0Wh7N5VimbVHl4c/7cUXVowksk8J3G85mbBeDUroDQPQ9eHY/Unq2PRUeSe54k2jij5kLvelBOdJmEdeX2KxvlXG3Qqyq/O7KMzfLBlEIAUyWmxUth5rcB40BHclUjBRi797/XC1Ldpi6Aw2ZK+EAJWfKefHoNF+3tzLWK/HQU8//yLghWy8KI6EdxqwqsvtTXGsT0D7c9VOrCXBDmNmP/+oYONmswFzCyM78IYM9Gv1Kp9wOsXs36CZukWgCZQ7YjpLWOSz1293lskITvQH8gdNO3GvLawp1bGnD14XXIEydzAxO2WpeQd/NUUrI9KjTF7D/hZFRFNoUBtOHsk/Uwvamh6CHS+9SEkGV2cLOFeOhg9VzxdgBgrDhZW4SVJP8cdshVGMPzRh0szxsEwAl1f67/xKaHA0JedrAJlHHJ56X306I5II4MnrlQLhSOwLfsjcN4a037mNZabls9WRBOssyrvQx3TnNSq30KhyzpXqHbfck+J59FFWB/6AuQIQpwwEWsFWHsqjAshYdCLgI2YMCWgcM6Ld6sUUdP2PECgljITe0=
